<div class="analytics-container">
  <!-- Header -->
  <div class="analytics-header">
    <div>
      <h1>Analytics</h1>
      <p class="subtitle">Track your store performance</p>
    </div>
    <div class="header-actions">
      <!-- Period Selector -->
      <div class="period-selector">
        <button
          class="period-btn"
          [class.active]="selectedPeriod === '7days'"
          (click)="changePeriod('7days')">
          7 Days
        </button>
        <button
          class="period-btn"
          [class.active]="selectedPeriod === '30days'"
          (click)="changePeriod('30days')">
          30 Days
        </button>
        <button
          class="period-btn"
          [class.active]="selectedPeriod === '90days'"
          (click)="changePeriod('90days')">
          90 Days
        </button>
      </div>

      @if (auth.isAdmin()) {
        <button class="btn-primary" (click)="exportReport()">
          <lucide-icon name="download" size="18"></lucide-icon>
          Export Report
        </button>
      }
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading">
      <lucide-icon name="loader-circle" size="32" class="spin"></lucide-icon>
      <p>Loading analytics...</p>
    </div>
  }

  @if (!isLoading) {
    <!-- Summary Cards -->
    <div class="summary-grid">
      <div class="summary-card">
        <div class="summary-icon revenue">
          <lucide-icon name="dollar-sign" size="24"></lucide-icon>
        </div>
        <div class="summary-content">
          <p class="summary-label">Total Revenue</p>
          <h3 class="summary-value">${{ summary.totalRevenue.toLocaleString() }}</h3>
          <span class="summary-trend positive">
            <lucide-icon name="trending-up" size="14"></lucide-icon>
            +{{ summary.revenueGrowth }}% vs last period
          </span>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-icon orders">
          <lucide-icon name="shopping-cart" size="24"></lucide-icon>
        </div>
        <div class="summary-content">
          <p class="summary-label">Total Orders</p>
          <h3 class="summary-value">{{ summary.totalOrders }}</h3>
          <span class="summary-trend positive">
            <lucide-icon name="trending-up" size="14"></lucide-icon>
            +12.5% vs last period
          </span>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-icon average">
          <lucide-icon name="chart-line" size="24"></lucide-icon>
        </div>
        <div class="summary-content">
          <p class="summary-label">Avg Order Value</p>
          <h3 class="summary-value">${{ summary.averageOrderValue.toFixed(2) }}</h3>
          <span class="summary-trend positive">
            <lucide-icon name="trending-up" size="14"></lucide-icon>
            +8.2% vs last period
          </span>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-icon stock">
          <lucide-icon name="triangle-alert" size="24"></lucide-icon>
        </div>
        <div class="summary-content">
          <p class="summary-label">Low Stock Items</p>
          <h3 class="summary-value">{{ summary.lowStockItems }}</h3>
          <span class="summary-trend negative">
            <lucide-icon name="circle-alert" size="14"></lucide-icon>
            Needs attention
          </span>
        </div>
      </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
      <!-- Revenue Chart -->
      <div class="chart-card large">
        <div class="chart-header">
          <div>
            <h2>Revenue Overview</h2>
            <p class="chart-subtitle">Daily revenue for selected period</p>
          </div>
          <lucide-icon name="trending-up-down" size="20" class="chart-icon"></lucide-icon>
        </div>
        <div class="chart-body">
          <canvas
            baseChart
            [data]="revenueChartData"
            [options]="revenueChartOptions"
            [type]="revenueChartType">
          </canvas>
        </div>
      </div>

      <!-- Category Distribution Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <div>
            <h2>Sales by Category</h2>
            <p class="chart-subtitle">Distribution of sales</p>
          </div>
          <lucide-icon name="chart-pie" size="20" class="chart-icon"></lucide-icon>
        </div>
        <div class="chart-body">
          <canvas
            baseChart
            [data]="categoryChartData"
            [options]="categoryChartOptions"
            [type]="categoryChartType">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Bottom Grid -->
    <div class="bottom-grid">
      <!-- Top Products -->
      <div class="data-card">
        <div class="data-header">
          <h2>Top Selling Products</h2>
          <lucide-icon name="star" size="20"></lucide-icon>
        </div>
        <div class="data-body">
          @for (product of topProducts; track product.name) {
            <div class="product-row">
              <div class="product-info">
                <lucide-icon [name]="getTrendIcon(product.trend)"
                  size="16"
                  [class.trend-up]="product.trend === 'up'"
                  [class.trend-down]="product.trend === 'down'">
                </lucide-icon>
                <div>
                  <p class="product-name">{{ product.name }}</p>
                  <p class="product-sales">{{ product.sales }} units sold</p>
                </div>
              </div>
              <p class="product-revenue">${{ product.revenue.toLocaleString() }}</p>
            </div>
          }
        </div>
      </div>

      <!-- Recent Transactions -->
@if (auth.isAdmin()) {
  <div class="data-card">
    <div class="data-header">
      <h2>Recent Transactions</h2>
      <lucide-icon name="receipt" size="20"></lucide-icon>
    </div>
    <div class="data-body">
      @for (transaction of recentTransactions; track transaction.id) {
        <div class="transaction-row">
          <div class="transaction-info">
            <p class="transaction-id">{{ transaction.id }}</p>
            <p class="transaction-product">{{ transaction.product }}</p>
            <p class="transaction-customer">{{ transaction.customer }}</p>  <!-- âœ… Added customer -->
            <p class="transaction-date">{{ transaction.date }}</p>
          </div>
          <div class="transaction-right">
            <p class="transaction-amount">${{ transaction.amount }}</p>
            <span class="transaction-status" [ngClass]="getStatusClass(transaction.status)">
              {{ transaction.status }}
            </span>
          </div>
        </div>
      }
    </div>
  </div>
}
    </div>
  }
</div>
